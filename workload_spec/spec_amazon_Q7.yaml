generation: {n: 10, mode: random, seed: 67}

templates:
  - id: HELPFUL_VOTE_BY_RATING
    sql: |
      SELECT rating,
             COUNT(*) AS review_cnt,
             SUM(helpful_vote) AS total_helpful
      FROM {{tbl}}
      WHERE verified_purchase = 'Y'
        AND record_timestamp BETWEEN TIMESTAMP ':ts_lo' AND TIMESTAMP ':ts_hi'
        AND helpful_vote BETWEEN :hv_lo AND :hv_hi
      GROUP BY rating
      HAVING SUM(helpful_vote) >= :min_helpful
      ORDER BY total_helpful DESC;
    params:
      ts_lo:       {type: date, range: ['2018-01-01', '2023-12-31']}
      ts_hi:       {type: date, range: ['2018-01-01', '2023-12-31'], constraint: "ts_hi >= ts_lo"}
      hv_lo:       {type: int,  range: [0, 150]}
      hv_hi:       {type: int,  range: [20, 400], constraint: "hv_hi >= hv_lo"}
      min_helpful: {type: int,  range: [50, 5000]}
    interval_rules:
      - {column: record_timestamp, lo: ts_lo, hi: ts_hi, type: date, ratio_range: [0.04, 0.15], clip_to_domain: true}
      - {column: helpful_vote,    lo: hv_lo, hi: hv_hi, type: int, ratio_range: [0.05, 0.25], clip_to_domain: true}
