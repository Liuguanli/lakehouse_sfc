generation: {n: 10, mode: random, seed: 43}

templates:
  - id: VERIFIED_PURCHASE_RATIO
    sql: |
      SELECT category,
             SUM(CASE WHEN verified_purchase = 'Y' THEN 1 ELSE 0 END) AS verified_cnt,
             COUNT(*) AS total_reviews,
             SUM(helpful_vote) AS helpful_votes
      FROM {{tbl}}
      WHERE category IN ('Home_and_Kitchen', 'Electronics', 'Books')
        AND record_timestamp BETWEEN TIMESTAMP ':ts_lo' AND TIMESTAMP ':ts_hi'
        AND rating BETWEEN :rating_lo AND :rating_hi
      GROUP BY category
      HAVING COUNT(*) >= :min_reviews
      ORDER BY verified_cnt DESC;
    params:
      ts_lo: {type: date, range: ['2018-01-01', '2023-12-31']}
      ts_hi: {type: date, range: ['2018-01-01', '2023-12-31'], constraint: "ts_hi >= ts_lo"}
      rating_lo: {type: int, range: [1, 4]}
      rating_hi: {type: int, range: [2, 5], constraint: "rating_hi >= rating_lo"}
      min_reviews: {type: int, range: [10, 500]}
    interval_rules:
      - {column: record_timestamp, lo: ts_lo, hi: ts_hi, type: date, ratio_range: [0.05, 0.20], clip_to_domain: true}
